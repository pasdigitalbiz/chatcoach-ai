<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ’˜Dating Buddy ğŸ’˜</title>
  <style>
    body {
      background-color: #FFE082;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      padding: 2rem;
      margin: 0 auto;
      max-width: 600px;
    }
    h1 {
      text-align: center;
      font-size: 2rem;
      margin-bottom: 1rem;
      color: #000;
    }
    textarea, input[type="file"], select {
      width: 100%;
      margin-top: 1rem;
      padding: 0.8rem;
      font-size: 1rem;
      border-radius: 8px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      background-color: #fffaf3;
      color: #333;
    }
    button {
      background-color: #ff5f7e;
      color: white;
      border: none;
      font-weight: bold;
      cursor: pointer;
      width: 100%;
      margin-top: 1rem;
      padding: 0.8rem;
      font-size: 1rem;
      border-radius: 8px;
    }
    #outputContainer {
      margin-top: 2rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .responseBox {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .copyBtn {
      background-color: #ff5f7e;
      color: white;
      border: none;
      padding: 0.4rem 0.8rem;
      font-size: 0.85rem;
      border-radius: 5px;
      cursor: pointer;
    }
    @media screen and (max-width: 600px) {
      body {
        padding: 1rem;
      }
      h1 {
        font-size: 1.5rem;
      }
      .responseBox {
        flex-direction: column;
        align-items: flex-start;
      }
      .copyBtn {
        margin-top: 0.5rem;
        width: 100%;
      }
    }
  </style>
<script defer data-domain="dating-buddy.com" src="https://plausible.io/js/script.file-downloads.hash.outbound-links.pageview-props.tagged-events.js"></script>
<script>window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments) }</script>

  
</head>
<body>
  <h1 id="title">ğŸ’˜Dating Buddy ğŸ’˜</h1>

<div style="display: flex; justify-content: center; margin-top: 1rem;">
  <script type="text/javascript">
    atOptions = {
      'key': 'f708fcea40e818d804fa27cace971ea3',
      'format': 'iframe',
      'height': 50,
      'width': 320,
      'params': {}
    };
  </script>
  <script type="text/javascript" src="//www.highperformanceformat.com/f708fcea40e818d804fa27cace971ea3/invoke.js"></script>
</div>
  <br>


<p id="intro" style="text-align: center; font-size: 1rem; color: #333; margin-top: 0.5rem; font-style: italic;"></p>

  <p id="intro" style="text-align: center; font-size: 1rem; color: #333; margin-top: 0.5rem; font-style: italic;"></p>

  <textarea id="inputText" rows="4"></textarea>

<div style="display: flex; justify-content: center; margin-top: 1rem;">
  <script type="text/javascript">
    atOptions = {
      'key': 'f708fcea40e818d804fa27cace971ea3',
      'format': 'iframe',
      'height': 50,
      'width': 320,
      'params': {}
    };
  </script>
  <script type="text/javascript" src="//www.highperformanceformat.com/f708fcea40e818d804fa27cace971ea3/invoke.js"></script>
</div>
  
  <input type="file" id="imageUpload" accept="image/*" />
  <button id="removeImageBtn" onclick="removeImage()" style="display:none; margin-top: 0.5rem;">ğŸ—‘ï¸ Remove</button>

  <select id="tone"></select>
  <select id="language"></select>

  <div style="margin-top: 1rem; font-size: 0.9rem;">
    <label>
      <input type="checkbox" id="privacyCheckbox" />
      <span id="privacyText"></span> <a href="/privacy.html" target="_blank">Privacy Policy</a>
    </label>
  </div>

  <div style="display: flex; justify-content: center; margin-top: 1rem;">
  <script type="text/javascript">
    atOptions = {
      'key': 'f708fcea40e818d804fa27cace971ea3',
      'format': 'iframe',
      'height': 50,
      'width': 320,
      'params': {}
    };
  </script>
  <script type="text/javascript" src="//www.highperformanceformat.com/f708fcea40e818d804fa27cace971ea3/invoke.js"></script>
</div>

  
  <button id="generateBtn" onclick="generateResponse()">Cosa rispondo?</button>

  <div style="display: flex; justify-content: center; margin-top: 1rem;">
  <script type='text/javascript' src='//pl26693436.profitableratecpm.com/6f/89/95/6f8995af99479724442477f099bbf6cf.js'></script>
</div>
  
  <div id="outputContainer"></div>
<script>
  const translations = {
    it: {
      intro: "ğŸ’¬ Hai un match ma non sai come rispondere?<br>Dating Buddy ti aiuta a scrivere messaggi brillanti, naturali e pronti allâ€™uso.<br>Puoi anche caricare uno screenshot per ricevere consigli su misura.",
      placeholder: "Scrivi qui il messaggio ricevuto o carica uno screenshot...",
      button: "Cosa rispondo?",
      privacy: "Ho letto e accetto la",
      errorPrivacy: "Per favore, accetta la Privacy Policy.",
      errorCooldown: "Troppo veloce! Attendi 1 minuto.",
      tones: ["ğŸ˜„ Divertente", "ğŸ’˜ Romantico", "ğŸ˜ Sicuro di sÃ©", "ğŸ˜ˆ Malizioso"],
      toneValues: ["Divertente", "Romantico", "Sicuro di sÃ©", "Malizioso"],
      languages: ["ğŸ‡®ğŸ‡¹ Italiano", "ğŸ‡¬ğŸ‡§ Inglese", "ğŸ‡«ğŸ‡· Francese", "ğŸ‡©ğŸ‡ª Tedesco", "ğŸ‡ªğŸ‡¸ Spagnolo"],
      langValues: ["Italiano", "Inglese", "Francese", "Tedesco", "Spagnolo"]
    },
    en: {
      intro: "ğŸ’¬ Got a match but donâ€™t know what to say?<br>Dating Buddy helps you craft clever, natural, ready-to-send replies.<br>You can also upload a screenshot for tailored advice.",
      placeholder: "Write here the message you received or upload a screenshot...",
      button: "What should I reply?",
      privacy: "I have read and accept the",
      errorPrivacy: "Please accept the Privacy Policy.",
      errorCooldown: "You're too fast! Please wait 1 minute.",
      tones: ["ğŸ˜„ Funny", "ğŸ’˜ Romantic", "ğŸ˜ Confident", "ğŸ˜ˆ Flirty"],
      toneValues: ["Funny", "Romantic", "Confident", "Flirty"],
      languages: ["ğŸ‡¬ğŸ‡§ English", "ğŸ‡®ğŸ‡¹ Italian", "ğŸ‡«ğŸ‡· French", "ğŸ‡©ğŸ‡ª German", "ğŸ‡ªğŸ‡¸ Spanish"],
      langValues: ["English", "Italian", "French", "German", "Spanish"]
    },
    fr: {
      intro: "ğŸ’¬ Un match et tu ne sais pas quoi rÃ©pondre ?<br>Dating Buddy tâ€™aide Ã  rÃ©diger des rÃ©ponses brillantes et naturelles.<br>Tu peux aussi envoyer une capture dâ€™Ã©cran pour un conseil personnalisÃ©.",
      placeholder: "Ã‰cris ici le message reÃ§u ou tÃ©lÃ©charge une capture dâ€™Ã©cran...",
      button: "Que rÃ©pondre ?",
      privacy: "Jâ€™ai lu et jâ€™accepte la",
      errorPrivacy: "Veuillez accepter la politique de confidentialitÃ©.",
      errorCooldown: "Trop rapide ! Attends 1 minute.",
      tones: ["ğŸ˜„ DrÃ´le", "ğŸ’˜ Romantique", "ğŸ˜ Confiant", "ğŸ˜ˆ SÃ©ducteur"],
      toneValues: ["DrÃ´le", "Romantique", "Confiant", "SÃ©ducteur"],
      languages: ["ğŸ‡«ğŸ‡· FranÃ§ais", "ğŸ‡®ğŸ‡¹ Italien", "ğŸ‡¬ğŸ‡§ Anglais", "ğŸ‡©ğŸ‡ª Allemand", "ğŸ‡ªğŸ‡¸ Espagnol"],
      langValues: ["FranÃ§ais", "Italien", "Anglais", "Allemand", "Espagnol"]
    },
    de: {
      intro: "ğŸ’¬ Du hast ein Match, aber weiÃŸt nicht, was du schreiben sollst?<br>Dating Buddy hilft dir, clevere und natÃ¼rliche Antworten zu schreiben.<br>Du kannst auch einen Screenshot hochladen fÃ¼r maÃŸgeschneiderte Tipps.",
      placeholder: "Schreib hier die Nachricht oder lade einen Screenshot hoch...",
      button: "Was soll ich antworten?",
      privacy: "Ich habe die gelesen und akzeptiere die",
      errorPrivacy: "Bitte akzeptiere die Datenschutzrichtlinie.",
      errorCooldown: "Zu schnell! Bitte warte 1 Minute.",
      tones: ["ğŸ˜„ Lustig", "ğŸ’˜ Romantisch", "ğŸ˜ Selbstbewusst", "ğŸ˜ˆ AnzÃ¼glich"],
      toneValues: ["Lustig", "Romantisch", "Selbstbewusst", "AnzÃ¼glich"],
      languages: ["ğŸ‡©ğŸ‡ª Deutsch", "ğŸ‡®ğŸ‡¹ Italienisch", "ğŸ‡¬ğŸ‡§ Englisch", "ğŸ‡«ğŸ‡· FranzÃ¶sisch", "ğŸ‡ªğŸ‡¸ Spanisch"],
      langValues: ["Deutsch", "Italienisch", "Englisch", "FranzÃ¶sisch", "Spanisch"]
    },
    es: {
      intro: "ğŸ’¬ Â¿Tienes un match y no sabes quÃ© responder?<br>Dating Buddy te ayuda a crear mensajes naturales y listos para usar.<br>TambiÃ©n puedes subir una captura de pantalla para recibir consejos personalizados.",
      placeholder: "Escribe aquÃ­ el mensaje recibido o sube una captura de pantalla...",
      button: "Â¿QuÃ© respondo?",
      privacy: "He leÃ­do y acepto la",
      errorPrivacy: "Por favor, acepta la polÃ­tica de privacidad.",
      errorCooldown: "Â¡Demasiado rÃ¡pido! Espera 1 minuto.",
      tones: ["ğŸ˜„ Divertido", "ğŸ’˜ RomÃ¡ntico", "ğŸ˜ Seguro de sÃ­", "ğŸ˜ˆ Atrevido"],
      toneValues: ["Divertido", "RomÃ¡ntico", "Seguro de sÃ­", "Atrevido"],
      languages: ["ğŸ‡ªğŸ‡¸ EspaÃ±ol", "ğŸ‡®ğŸ‡¹ Italiano", "ğŸ‡¬ğŸ‡§ InglÃ©s", "ğŸ‡«ğŸ‡· FrancÃ©s", "ğŸ‡©ğŸ‡ª AlemÃ¡n"],
      langValues: ["EspaÃ±ol", "Italiano", "InglÃ©s", "FrancÃ©s", "AlemÃ¡n"]
    }
  };

  const lang = navigator.language.slice(0, 2);
  const t = translations[lang] || translations.en;

  document.getElementById("intro").innerHTML = t.intro;
  document.getElementById("inputText").placeholder = t.placeholder;
  document.getElementById("generateBtn").textContent = t.button;
  document.getElementById("privacyText").textContent = t.privacy;

  const toneSelect = document.getElementById("tone");
  t.tones.forEach((label, i) => {
    const opt = document.createElement("option");
    opt.value = t.toneValues[i];
    opt.textContent = label;
    if (i === 0) opt.selected = true;
    toneSelect.appendChild(opt);
  });

  const langSelect = document.getElementById("language");
  t.languages.forEach((label, i) => {
    const opt = document.createElement("option");
    opt.value = t.langValues[i];
    opt.textContent = label;
    if (i === 0) opt.selected = true;
    langSelect.appendChild(opt);
  });
</script>
<script>
  let isBlocked = false;
  let requestTimestamps = JSON.parse(localStorage.getItem("generationTimestamps")) || [];

  function checkSpamAndSetBlock() {
    const now = Date.now();
    requestTimestamps = requestTimestamps.filter(t => now - t < 30000);
    if (requestTimestamps.length >= 3) {
      isBlocked = true;
      alert(t.errorCooldown || "Please wait 1 minute.");
      document.getElementById("generateBtn").disabled = true;
      setTimeout(() => {
        isBlocked = false;
        document.getElementById("generateBtn").disabled = false;
      }, 60000);
      return true;
    }
    requestTimestamps.push(now);
    localStorage.setItem("generationTimestamps", JSON.stringify(requestTimestamps));
    return false;
  }

  async function extractTextFromImage(file) {
    const formData = new FormData();
    formData.append("file", file);
    const res = await fetch("https://api.ocr.space/parse/image", {
      method: "POST",
      headers: { apikey: "K88097990988957" },
      body: formData
    });
    const data = await res.json();
    return data.ParsedResults?.[0]?.ParsedText || "";
  }

  async function generateResponse() {
    if (isBlocked) {
      alert(t.errorCooldown || "Please wait 1 minute.");
      return;
    }

    if (!document.getElementById("privacyCheckbox").checked) {
      alert(t.errorPrivacy || "Please accept the Privacy Policy.");
      return;
    }

    if (checkSpamAndSetBlock()) return;

    const inputText = document.getElementById("inputText").value;
    const tone = document.getElementById("tone").value;
    const language = document.getElementById("language").value;
    const image = document.getElementById("imageUpload").files[0];

    let finalInput = inputText;
    if (image) {
      const extractedText = await extractTextFromImage(image);
      finalInput = inputText + "\n" + extractedText;
    }

    if (!finalInput.trim()) {
      alert("Inserisci un testo o screenshot.");
      return;
    }

    const payload = { inputText: finalInput, tone, language };

    try {
      const res = await fetch("/api/generate", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      const data = await res.json();
      const container = document.getElementById("outputContainer");
      container.innerHTML = "";

      if (data.output) {
        const responses = data.output.split(/\n+/).filter(r => r.trim());
        responses.forEach(resp => {
          const box = document.createElement("div");
          box.className = "responseBox";
          box.innerHTML = `
            <span>${resp}</span>
            <button class="copyBtn" onclick='navigator.clipboard.writeText(\`${resp.replace(/`/g, "\\`")}\`)'>ğŸ“‹ Copia</button>`;
          container.appendChild(box);
        });
      } else {
        container.textContent = "Nessuna risposta generata.";
      }
    } catch (err) {
      document.getElementById("outputContainer").textContent = "Errore: " + err.message;
    }
  }
    document.getElementById("imageUpload").addEventListener("change", function () {
    const file = this.files[0];
    document.getElementById("removeImageBtn").style.display = file ? "block" : "none";
  });

  function removeImage() {
    const input = document.getElementById("imageUpload");
    input.value = "";
    document.getElementById("removeImageBtn").style.display = "none";
  }

</script>
</body>
</html>
